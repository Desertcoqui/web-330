<!-- // Title: WhatABook Part 1
// Author: Professor Kumar
// Modified by: Ferdinand Detres
// Date: July 8 2022
// Description: Book that uses XMl to fetch data
//https://developer.mozilla.org/en-US/docs/Web/API/Document/DOMContentLoaded_event
//https://www.stat.auckland.ac.nz/~paul/ItDT/HTML/node46.html#:~:text=The%20main%20content%20of%20an,the%20form%20.

-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>WEB 330 - Enterprise JavaScript II</title>

    <!-- css -->

    <link rel="stylesheet" type="text/css" href="../site.css" />
    <link rel="stylesheet" type="text/css" href="../theme.css" />



    <!-- font links -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- scripts -->
    <script src="../theme.js"></script>
</head>

<div class="light-theme">
    <i onclick="toggleMode(this)" id="icon-mode" class="fa fa-toggle-off pull-right" style="font-size: 28px"><span
            id="icon-text"></span></i>
    <!-- Assignment Container -->
    <div class="assign-container">
        <h1 class="app-header">Welcome to the WhatABook, Part 1!</h1>
        <div class="assign-content">
            <div class="card">
                <div class="card-title">Book Listing</div>
                <div class="card-content" id="bookList">

                </div>
            </div>
            <a class="return-home" href="../index.html">Return</a>
        </div>
        <!-- End Book List -->

        <!-- Results Container -->
        <div class="assign-container">
            <div class="assign-content">
                <div class="card">
                    <div class="card-title">Selected Book</div>
                    <div class="card-content assign-results-text" id="selectedBook"></div>
                </div>
            </div>
        </div>
    </div>










    <script type='module'>
        // imports
        setDefaultTheme();
        // Event Handler
        document.addEventListener('DOMContentLoaded',(event) => {
            //assign xml file to variable that then fetches the data
            let fileName='./book.xml';
            fetch(fileName)
                .then(res => res.text())
                //DOM XML Parser
                .then((data) => {
                    //new DOMParser object assigned to variable domParser
                    let domParser=new DOMParser();
                    let xmlBooks=domParser.parseFromString(data,'text/html');

                    //function call which will load xml into the html table

                    loadBooks(xmlBooks);
                    addIsbnClickEvents();
                })
        });
        function loadBooks(xml) {

            let books=xml.getElementsByTagName('book')
            let tableData=`

        <table id="bookTable" class="table">

            <tr>
                <th>
                    ISBN
                </th>
                <th>
                    Title
                </th>
                <th>
                    Description
                </th>
                <th>
                    Pages
                </th>
                <th>
                    Authors
                </th>
            </tr>
            <tbody>`;

            //iterating over books
            for(let book of books) {


                //assigning variables to XML dom Values
                let isbn=book.getElementsByTagName('isbn')[0].childNodes[0].nodeValue;
                let title=book.getElementsByTagName('title')[0].childNodes[0].nodeValue;
                let description=book.getElementsByTagName('description')[0].childNodes[0].nodeValue;
                let pages=book.getElementsByTagName('pages')[0].childNodes[0].nodeValue;
                let author=book.getElementsByTagName('author')[0].childNodes[0].nodeValue;

                //XML book data created into html table

                tableData+=`<tr>
                    <td data-value='ISBN'><a href='#' class='isbn-link'>${isbn}</a></td>
                    <td data-value='Title'>${title}</td>
                    <td data-value='Description'>${description}</td>
                    <td data-value='Pages'>${pages}</td>
                    <td data-value='Author'>${author}</td>
                </tr>
                `;

            }
            document.getElementById('bookList').innerHTML=tableData+=`</tbody>
        </table>`;

        }

        //function generates selected book for second card
        function anchorClicked(e) {
            e.preventDefault();
            let self=this;
            let cell=self.parentElement;
            let row=cell.parentElement;
            let data=row.querySelectorAll('td');

            let bookData=`<ul style='list-style-type:none; text-align: left; font-size: 1rem'>`;

            for(let field of data) {
                bookData+=`<li><b>${field.dataset.value}:</b> ${field.innerText} </li>`;
                console.log(field);
            }

            document.getElementById('selectedBook').innerHTML=bookData+`</ul>`;
        }
        //add event listener to chosen item Array
        function addIsbnClickEvents() {
            let viewButtons=document.querySelectorAll('#bookTable tbody .isbn-link');
            for(let i=0;i<viewButtons.length;i++) {
                viewButtons[i].addEventListener('click',anchorClicked);
            }
        }





        toggleMode();
    </script>

    </body>

</html>